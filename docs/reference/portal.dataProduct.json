{
    "$schema": "<relative path to createFormUI.schema.json>",
    "view": {
        "kind": "Form",
        "properties": {
            "title": "Enterprise-Scale Analytics - Data Product Batch",
            "steps": [
                {
                    "name": "basics",
                    "label": "Data Product",
                    "elements": [
                        {
                            "name": "infoBoxEnterpriseScaleAnalytics",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": true,
                            "options": {
                                "text": "Enterprise-Scale Analytics is a prescriptive reference architecture for data with reference implementation provided by Microsoft. Visit 'aka.ms/adopt/datamanagement' for more details about the solution pattern.",
                                "style": "Info",
                                "uri": "https://aka.ms/adopt/datamanagement"
                            }
                        },
                        {
							"name": "deploymentDetails",
							"label": "Deployment Details",
							"type": "Microsoft.Common.Section",
                            "visible": true,
							"elements": [
                                {
									"name": "deploymentDetailsText",
									"type": "Microsoft.Common.TextBlock",
									"visible": true,
									"options": {
										"text": "Select the subscription and resource group as well as the location to specify the scope of your Data Product deployment.",
										"link": {
											"label": "",
											"uri": ""
										}
									}
								},
                                {
                                    "name": "infoBoxPrerequisites",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": true,
                                    "options": {
                                        "text": "Please make sure that you have a Data Management Zone and Data Landing Zone deployed before deploying a Data Product or Data Integration template.",
                                        "style": "Warning",
                                        "uri": "https://github.com/Azure/data-management-zone"
                                    }
                                },
                                {
                                    "name": "subscriptionApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "subscriptions?api-version=2020-01-01"
                                    }
                                },
                                {
                                    "name": "subscriptionId",
                                    "label": "Subscription",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Select the Subscription of your Data Landing Zone.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(steps('basics').deploymentDetails.subscriptionApi.value, (item) => parse(concat('{\"label\":\"', item.displayName, '\",\"value\":\"', item.id, '\",\"description\":\"', 'ID: ', item.subscriptionId, '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "resourceGroupApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "[concat(steps('basics').deploymentDetails.subscriptionId, '/resourcegroups?api-version=2020-01-01')]"
                                    }
                                },
                                {
                                    "name": "resourceGroupId",
                                    "label": "Resource Group",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Select the Resource Group for your Data Product Deployment.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(steps('basics').deploymentDetails.resourceGroupApi.value, (item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Subscription ID: ', last(take(split(item.id, '/'), 3)), '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "infoBoxLocation",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": true,
                                    "options": {
                                        "text": "Since not all service features are available in all regions, Enterprise Scale Analytics is available in a subset of regions.",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "locationsApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "locations?api-version=2019-11-01"
                                    }
                                },
                                {
                                    "name": "locationName",
                                    "label": "Location",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Select the Location for your Deployment.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('basics').deploymentDetails.locationsApi.value,(item) => contains(split('southafricanorth,southeastasia,japaneast,canadacentral,northeurope,westeurope,francecentral,germanywestcentral,uksouth,centralus,eastus,eastus2,southcentralus,westus2', ','), item.name)),(item) => parse(concat('{\"label\":\"', item.regionalDisplayName, '\",\"value\":\"', item.name, '\"}')))]",
                                        "required": true
                                    }
                                }
                            ]
                        },
                        {
							"name": "dataProductName",
							"label": "Data Product Name",
							"type": "Microsoft.Common.Section",
                            "visible": true,
							"elements": [
                                {
									"name": "dataPruductNamesText",
									"type": "Microsoft.Common.TextBlock",
									"visible": true,
									"options": {
										"text": "Specify a prefix and environment name which will be used as a prefix for all resource names.",
										"link": {
											"label": "",
											"uri": ""
										}
									}
								},
                                {
                                    "name": "dataProductPrefix",
                                    "label": "Data Product Prefix",
                                    "type": "Microsoft.Common.TextBox",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Specify a prefix (min 1 and max 10 lowercase characters and numbers).",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9]{1,10}$",
                                        "validationMessage": "The prefix must be between 1-10 lowercase characters and numbers."
                                    }
                                },
                                {
                                    "name": "environment",
                                    "label": "Environment",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "defaultValue": "Development",
                                    "toolTip": "Select the environment for the deployment. This is currently only used for the naming of resources.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "Development",
                                                "description": "Select if you want to deploy a development environment.",
                                                "value": "dev"
                                            },
                                            {
                                                "label": "Test",
                                                "description": "Select if you want to deploy a test environment.",
                                                "value": "tst"
                                            },
                                            {
                                                "label": "Production",
                                                "description": "Select if you want to deploy a production environment.",
                                                "value": "prd"
                                            }
                                        ],
                                        "required": true
                                    }
                                }
                            ]
                        }
                    ]
                },
				{
					"name": "generalSettings",
					"label": "General Settings",
					"subLabel": {
						"preValidation": "Provide settings for your data product deployment.",
                        "postValidation": "Done"
					},
					"bladeTitle": "General Settings",
                    "bladeSubtitle": "General Settings",
					"elements": [
                        {
							"name": "synapseDeploymentSettings",
							"label": "Synapse Deployment Settings",
							"type": "Microsoft.Common.Section",
                            "visible": true,
							"elements": [
                                {
									"name": "synapseDeploymentSettingsText",
									"type": "Microsoft.Common.TextBlock",
									"visible": true,
									"options": {
										"text": "Specify settings for your Synapse workspace.",
										"link": {
											"label": "Learn more",
											"uri": "https://docs.microsoft.com/en-us/azure/synapse-analytics/overview-what-is"
										}
									}
								},
                                {
                                    "name": "administratorPassword",
                                    "label": {
                                        "password": "Password",
                                        "confirmPassword": "Confirm password"
                                    },
                                    "type": "Microsoft.Compute.CredentialsCombo",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": {
                                        "password": "Specify an administrator password for the Synapse workspace."
                                    },
                                    "constraints": {
                                        "required": true,
                                        "customPasswordRegex": "^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!@$%^&*-]).{8,128}$",
                                        "customValidationMessage": "The password must be alphanumeric, contain at least 8 characters, and have at least 1 letter, 1 number and one special character."
                                    },
                                    "options": {
                                        "hideConfirmation": false
                                    },
                                    "osPlatform": "Windows"
                                },
                                {
                                    "name": "synapseDefaultStorageAccountApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "[concat(steps('basics').deploymentDetails.subscriptionId, '/providers/Microsoft.Storage/storageAccounts?api-version=2021-04-01')]"
                                    }
                                },
                                {
                                    "name": "synapseDefaultStorageAccountId",
                                    "label": "Storage Account",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Select the Storage account to which you want to connect Synapse.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('generalSettings').synapseDeploymentSettings.synapseDefaultStorageAccountApi.value,(item) => and(equals(item.location, steps('basics').deploymentDetails.locationName), equals(item.properties.isHnsEnabled, true))),(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "synapseDefaultStorageAccountFileSystemApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "[concat(steps('generalSettings').synapseDeploymentSettings.synapseDefaultStorageAccountId, '/blobServices/default/containers?api-version=2021-04-01')]"
                                    }
                                },
                                {
                                    "name": "synapseDefaultStorageAccountFileSystemId",
                                    "label": "Synapse Default Storage Account Container",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Default storage container for the Synapse workspace. If no option is shown, please make sure that a container exists within the storage account selected above.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(steps('generalSettings').synapseDeploymentSettings.synapseDefaultStorageAccountFileSystemApi.value, (item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\"}')))]",
                                        "required": true
                                    }
                                }
                            ]
                        },
                        {
							"name": "dataGovernanceSettings",
							"label": "Data Governance Settings",
							"type": "Microsoft.Common.Section",
                            "visible": true,
							"elements": [
                                {
									"name": "dataGovernanceSettingsText",
									"type": "Microsoft.Common.TextBlock",
									"visible": true,
									"options": {
										"text": "Select the Purview account to which you want to connect the Synapse workspace.",
										"link": {
											"label": "Learn more",
											"uri": "https://docs.microsoft.com/en-us/azure/purview/overview"
										}
									}
								},
                                {
                                    "name": "purviewId",
                                    "label": "Connect to Purview Account",
                                    "type": "Microsoft.Solutions.ResourceSelector",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Select the Purview account to which you want to connect the Synapse workspace.",
                                    "resourceType": "Microsoft.Purview/accounts",
                                    "required": true,
                                    "options": {
                                        "filter": {
                                            "subscription": "all",
                                            "location": "all"
                                        }
                                    }
                                }
                            ]
                        },
                        {
							"name": "generalSettings",
							"label": "General Settings",
							"type": "Microsoft.Common.Section",
                            "visible": true,
							"elements": [
                                {
									"name": "generalSettingsText",
									"type": "Microsoft.Common.TextBlock",
									"visible": true,
									"options": {
										"text": "Specify general settings for this deployment.",
										"link": {
											"label": "",
											"uri": ""
										}
									}
								},
                                {
                                    "name": "sqlFlavour",
                                    "label": "SQL Flavour",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "defaultValue": "SQL Server",
                                    "toolTip": "Select the SQL flavour that should be deployed as part of this deployment.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "SQL Server",
                                                "value": "sql"
                                            },
                                            {
                                                "label": "MySQL Server",
                                                "value": "mysql"
                                            },
                                            {
                                                "label": "PostgreSQL Server",
                                                "value": "postgre"
                                            },
                                            {
                                                "label": "MariaDB Server",
                                                "value": "maria"
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "infoBoxRoleAssignment",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": true,
                                    "options": {
                                        "text": "The role assignment is optional and will assign the Synapse MSI to the respective selected default Storage Account Container (Storage Blob Data Contributor).",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "enableRoleAssignments",
                                    "label": "Enable role assignments",
                                    "type": "Microsoft.Common.CheckBox",
                                    "visible": true,
                                    "defaultValue": false,
                                    "toolTip": "Enable role assignments.",
                                    "constraints": {
                                        "required": false,
                                        "validationMessage": "Enable role assignments of the Synapse MSI. Please read infobox above for more details."
                                    }
                                }
                            ]
                        }
					]
				},
                {
                    "name": "connectivitySettings",
                    "label": "Connectivity Settings",
                    "subLabel": {
                        "preValidation": "Provide the connectivity settings that should be used for the Data Product.",
                        "postValidation": "Done"
                    },
                    "bladeTitle": "Connectivity Settings",
                    "bladeSubtitle": "Connectivity Settings",
                    "elements": [
                        {
                            "name": "infoBoxVirtualNetwork",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": true,
                            "options": {
                                "text": "Please select the Virtual Network of your Data Landing Zone and select a free Subnet within the Virtual Network to make sure that you have proper outbound connectivity as well as DNS name resolution in place. The subnet must have 'privateEndpointNetworkPolicies' and 'privateLinkServiceNetworkPolicies' set to disabled. This is already pre-configured for you in the DataProduct and DataIntegration subnets in the Data Landing Zone Vnet.",
                                "style": "Info"
                            }
                        },
                        {
                            "name": "vnet",
                            "label": {
                                "virtualNetwork": "Virtual network",
                                "subnets": "Subnet"
                            },
                            "type": "Microsoft.Network.VirtualNetworkCombo",
                            "visible": true,
                            "toolTip": {
                                "virtualNetwork": "Virtual Network for Data Product",
                                "subnets": "Subnet for Data Product"
                            },
                            "defaultValue": {
                                "name": "",
                                "addressPrefixSize": "/27"
                            },
                            "constraints": {
                                "minAddressPrefixSize": "/27"
                            },
                            "options": {
                                "hideExisting": false
                            },
                            "subnets": {
                                "subnet1": {
                                    "label": "Data Product Subnet",
                                    "defaultValue": {
                                        "name": "dataproductSubnet",
                                        "addressPrefixSize": "/27"
                                    },
                                    "constraints": {
                                        "minAddressPrefixSize": "/27",
                                        "minAddressCount": 13,
                                        "requireContiguousAddresses": true
                                    }
                                }
                            },
                            "scope": {
                                "subscriptionId": "[last(split(steps('basics').deploymentDetails.subscriptionId, '/'))]",
                                "location": "[steps('basics').deploymentDetails.locationName]"
                            }
                        },
                        {
							"name": "privateDnsZones",
							"label": "Private DNS Zones",
							"type": "Microsoft.Common.Section",
                            "visible": true,
							"elements": [
                                {
									"name": "privateDnsZonesText",
									"type": "Microsoft.Common.TextBlock",
									"visible": true,
									"options": {
										"text": "Select the Private DNS Zone settings for your deployment.",
										"link": {
											"label": "",
											"uri": ""
										}
									}
								},
                                {
                                    "name": "infoBoxPrivateDnsZone",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": true,
                                    "options": {
                                        "text": "We are deploying all services with private endpoints and disabled public network access to reduce the data exfiltration risk. For each private endpoint, DNS A-records need to be created in a Private DNS Zones. Therefore, these either need to deployed through Azure Policies or you have to provide the Private DNS Zones that should be used for this deployment. We are assuming that all Private DNS Zones are created in the same subscription. Deploying DNS A-Records through Private Endpoints is the recommended solution.",
                                        "style": "Info",
                                        "uri": "https://docs.microsoft.com/en-us/azure/cloud-adoption-framework/ready/azure-best-practices/private-link-and-dns-integration-at-scale"
                                    }
                                },
                                {
                                    "name": "automatedPrivateDnsZoneGroups",
                                    "label": "DNS A-Records are deployed through Azure Policy",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "visible": true,
                                    "toolTip": "If 'No' is selected, you will have to choose private DNS Zones that will be used for the A-Record deployment of the private DNS Zones.",
                                    "defaultValue": "Yes",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "Yes",
                                                "value": "yes"
                                            },
                                            {
                                                "label": "No",
                                                "value": "no"
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "subscriptionApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "subscriptions?api-version=2020-01-01"
                                    }
                                },
                                {
                                    "name": "privateDnsZonesSub",
                                    "label": "Private DNS Zone Subscription",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[equals(steps('connectivitySettings').privateDnsZones.automatedPrivateDnsZoneGroups, 'no')]",
                                    "defaultValue": "",
                                    "toolTip": "Select the Subscription of your Private DNS Zones.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(steps('connectivitySettings').privateDnsZones.subscriptionApi.value, (item) => parse(concat('{\"label\":\"', item.displayName, '\",\"value\":\"', item.id, '\",\"description\":\"', 'ID: ', item.subscriptionId, '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "privateDnsZonesApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "[concat(steps('connectivitySettings').privateDnsZones.privateDnsZonesSub, '/providers/Microsoft.Network/privateDnsZones?api-version=2018-09-01')]"
                                    }
                                },
                                {
                                    "name": "privateDnsZoneIdKeyVault",
                                    "label": "Private DNS Zone Key Vault (privatelink.vaultcore.azure.net)",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[equals(steps('connectivitySettings').privateDnsZones.automatedPrivateDnsZoneGroups, 'no')]",
                                    "defaultValue": "",
                                    "toolTip": "Private DNS Zone for Key Vault (privatelink.vaultcore.azure.net).",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('connectivitySettings').privateDnsZones.privateDnsZonesApi.value,(item) => contains(item.name, 'privatelink.vaultcore.azure.net')),(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "privateDnsZoneIdSynapseDev",
                                    "label": "Private DNS Zone Synapse Dev (privatelink.dev.azuresynapse.net)",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[equals(steps('connectivitySettings').privateDnsZones.automatedPrivateDnsZoneGroups, 'no')]",
                                    "defaultValue": "",
                                    "toolTip": "Private DNS Zone for Synapse Dev (privatelink.dev.azuresynapse.net).",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('connectivitySettings').privateDnsZones.privateDnsZonesApi.value,(item) => contains(item.name, 'privatelink.dev.azuresynapse.net')),(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "privateDnsZoneIdSynapseSql",
                                    "label": "Private DNS Zone Synapse Sql (privatelink.sql.azuresynapse.net)",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[equals(steps('connectivitySettings').privateDnsZones.automatedPrivateDnsZoneGroups, 'no')]",
                                    "defaultValue": "",
                                    "toolTip": "Private DNS Zone for Synapse Sql (privatelink.sql.azuresynapse.net).",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('connectivitySettings').privateDnsZones.privateDnsZonesApi.value,(item) => contains(item.name, 'privatelink.sql.azuresynapse.net')),(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "privateDnsZoneIdDataFactory",
                                    "label": "Private DNS Zone DataFactory (privatelink.datafactory.azure.net)",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[equals(steps('connectivitySettings').privateDnsZones.automatedPrivateDnsZoneGroups, 'no')]",
                                    "defaultValue": "",
                                    "toolTip": "Private DNS Zone for DataFactory (privatelink.datafactory.azure.net).",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('connectivitySettings').privateDnsZones.privateDnsZonesApi.value,(item) => contains(item.name, 'privatelink.datafactory.azure.net')),(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "privateDnsZoneIdDataFactoryPortal",
                                    "label": "Private DNS Zone DataFactory Portal (privatelink.adf.azure.com)",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[equals(steps('connectivitySettings').privateDnsZones.automatedPrivateDnsZoneGroups, 'no')]",
                                    "defaultValue": "",
                                    "toolTip": "Private DNS Zone for DataFactory Portal (privatelink.adf.azure.com).",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('connectivitySettings').privateDnsZones.privateDnsZonesApi.value,(item) => contains(item.name, 'privatelink.adf.azure.com')),(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "privateDnsZoneIdCosmosdbSql",
                                    "label": "Private DNS Zone Cosmos SQL (privatelink.documents.azure.com)",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[equals(steps('connectivitySettings').privateDnsZones.automatedPrivateDnsZoneGroups, 'no')]",
                                    "defaultValue": "",
                                    "toolTip": "Private DNS Zone for Cosmos SQL (privatelink.documents.azure.com).",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('connectivitySettings').privateDnsZones.privateDnsZonesApi.value,(item) => contains(item.name, 'privatelink.documents.azure.com')),(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "privateDnsZoneIdSqlServer",
                                    "label": "Private DNS Zone SQL Server (privatelink.database.windows.net)",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[equals(steps('connectivitySettings').privateDnsZones.automatedPrivateDnsZoneGroups, 'no')]",
                                    "defaultValue": "",
                                    "toolTip": "Private DNS Zone for SQL Server (privatelink.database.windows.net).",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('connectivitySettings').privateDnsZones.privateDnsZonesApi.value,(item) => contains(item.name, 'privatelink.database.windows.net')),(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "privateDnsZoneIdMySqlServer",
                                    "label": "Private DNS Zone MySQL Server (privatelink.mysql.database.azure.com)",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[equals(steps('connectivitySettings').privateDnsZones.automatedPrivateDnsZoneGroups, 'no')]",
                                    "defaultValue": "",
                                    "toolTip": "Private DNS Zone for MySQL Server (privatelink.mysql.database.azure.com).",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('connectivitySettings').privateDnsZones.privateDnsZonesApi.value,(item) => contains(item.name, 'privatelink.mysql.database.azure.com')),(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "privateDnsZoneIdMariaDb",
                                    "label": "Private DNS Zone MariaDB Server (privatelink.mariadb.database.azure.com)",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[equals(steps('connectivitySettings').privateDnsZones.automatedPrivateDnsZoneGroups, 'no')]",
                                    "defaultValue": "",
                                    "toolTip": "Private DNS Zone for MariaDB Server (privatelink.mariadb.database.azure.com).",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('connectivitySettings').privateDnsZones.privateDnsZonesApi.value,(item) => contains(item.name, 'privatelink.mariadb.database.azure.com')),(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "privateDnsZoneIdPostgreSql",
                                    "label": "Private DNS Zone PostgreSQL Server (privatelink.postgres.database.azure.com)",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[equals(steps('connectivitySettings').privateDnsZones.automatedPrivateDnsZoneGroups, 'no')]",
                                    "defaultValue": "",
                                    "toolTip": "Private DNS Zone for PostgreSQL Server (privatelink.postgres.database.azure.com).",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('connectivitySettings').privateDnsZones.privateDnsZonesApi.value,(item) => contains(item.name, 'privatelink.postgres.database.azure.com')),(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                        "required": true
                                    }
                                }
							]
						}
                    ]
                },
                {
                    "name": "tags",
                    "label": "Tags",
                    "subLabel": {
                        "preValidation": "Provide tags that will be used for all resources.",
                        "postValidation": "Done"
                    },
                    "bladeTitle": "Tags",
                    "bladeSubtitle": "Tags",
                    "elements": [
                        {
                            "name": "tagsByResource",
                            "label": "Tags by Resource",
                            "type": "Microsoft.Common.TagsByResource",
                            "visible": true,
                            "resources": [
                                "EnterpriseScaleAnalytics"
                            ]
                        }
                    ]
                }
            ]
        },
        "outputs": {
            "kind": "ResourceGroup",
            "location": "[steps('basics').deploymentDetails.locationName]",
            "resourceGroupId": "[steps('basics').deploymentDetails.resourceGroupId]",
            "parameters": {
                "location": "[if(empty(steps('basics').deploymentDetails.locationName), '', steps('basics').deploymentDetails.locationName)]",
                "environment": "[if(empty(steps('basics').dataProductName.environment), '', steps('basics').dataProductName.environment)]",
                "prefix": "[if(empty(steps('basics').dataProductName.dataProductPrefix), '', steps('basics').dataProductName.dataProductPrefix)]",
                "sqlFlavour": "[if(empty(steps('generalSettings').generalSettings.sqlFlavour), '', steps('generalSettings').generalSettings.sqlFlavour)]",
                "administratorPassword": "[if(empty(steps('generalSettings').synapseDeploymentSettings.administratorPassword.password), '', steps('generalSettings').synapseDeploymentSettings.administratorPassword.password)]",
                "synapseDefaultStorageAccountFileSystemId": "[if(empty(steps('generalSettings').synapseDeploymentSettings.synapseDefaultStorageAccountFileSystemId), '', steps('generalSettings').synapseDeploymentSettings.synapseDefaultStorageAccountFileSystemId)]",
                "purviewId": "[if(empty(steps('generalSettings').dataGovernanceSettings.purviewId.id), '', steps('generalSettings').dataGovernanceSettings.purviewId.id)]",
                "enableRoleAssignments": "[steps('generalSettings').generalSettings.enableRoleAssignments]",
                "subnetId": "[if(empty(steps('connectivitySettings').vnet.subnets.subnet1.name), '', concat(steps('basics').deploymentDetails.subscriptionId, '/resourceGroups/', steps('connectivitySettings').vnet.resourceGroup, '/providers/Microsoft.Network/virtualNetworks/', steps('connectivitySettings').vnet.name, '/subnets/', steps('connectivitySettings').vnet.subnets.subnet1.name))]",
                "privateDnsZoneIdKeyVault": "[if(empty(steps('connectivitySettings').privateDnsZones.privateDnsZoneIdKeyVault), '', steps('connectivitySettings').privateDnsZones.privateDnsZoneIdKeyVault)]",
                "privateDnsZoneIdSynapseDev": "[if(empty(steps('connectivitySettings').privateDnsZones.privateDnsZoneIdSynapseDev), '', steps('connectivitySettings').privateDnsZones.privateDnsZoneIdSynapseDev)]",
                "privateDnsZoneIdSynapseSql": "[if(empty(steps('connectivitySettings').privateDnsZones.privateDnsZoneIdSynapseSql), '', steps('connectivitySettings').privateDnsZones.privateDnsZoneIdSynapseSql)]",
                "privateDnsZoneIdDataFactory": "[if(empty(steps('connectivitySettings').privateDnsZones.privateDnsZoneIdDataFactory), '', steps('connectivitySettings').privateDnsZones.privateDnsZoneIdDataFactory)]",
                "privateDnsZoneIdDataFactoryPortal": "[if(empty(steps('connectivitySettings').privateDnsZones.privateDnsZoneIdDataFactoryPortal), '', steps('connectivitySettings').privateDnsZones.privateDnsZoneIdDataFactoryPortal)]",
                "privateDnsZoneIdCosmosdbSql": "[if(empty(steps('connectivitySettings').privateDnsZones.privateDnsZoneIdCosmosdbSql), '', steps('connectivitySettings').privateDnsZones.privateDnsZoneIdCosmosdbSql)]",
                "privateDnsZoneIdSqlServer": "[if(empty(steps('connectivitySettings').privateDnsZones.privateDnsZoneIdSqlServer), '', steps('connectivitySettings').privateDnsZones.privateDnsZoneIdSqlServer)]",
                "privateDnsZoneIdMySqlServer": "[if(empty(steps('connectivitySettings').privateDnsZones.privateDnsZoneIdMySqlServer), '', steps('connectivitySettings').privateDnsZones.privateDnsZoneIdMySqlServer)]",
                "privateDnsZoneIdMariaDb": "[if(empty(steps('connectivitySettings').privateDnsZones.privateDnsZoneIdMariaDb), '', steps('connectivitySettings').privateDnsZones.privateDnsZoneIdMariaDb)]",
                "privateDnsZoneIdPostgreSql": "[if(empty(steps('connectivitySettings').privateDnsZones.privateDnsZoneIdPostgreSql), '', steps('connectivitySettings').privateDnsZones.privateDnsZoneIdPostgreSql)]",
                "tags": "[if(not(contains(steps('tags').tagsByResource, 'EnterpriseScaleAnalytics')), parse('{}'), first(map(parse(concat('[', string(steps('tags').tagsByResource), ']')), (item) => item.EnterpriseScaleAnalytics)))]"
            }
        }
    }
}